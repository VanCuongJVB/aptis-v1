<IfModule mod_rewrite.c>
    RewriteEngine On

    # If request already points to /public, allow through
    RewriteCond %{REQUEST_URI} !^/public/

    # If a file or directory exists under public/, serve it from there
    RewriteCond %{DOCUMENT_ROOT}/public/%{REQUEST_URI} -f [OR]
    RewriteCond %{DOCUMENT_ROOT}/public/%{REQUEST_URI} -d
    RewriteRule ^(.*)$ /public/$1 [L]

    # Otherwise route everything to public/index.php
    RewriteRule ^(.*)$ /public/index.php [L]
</IfModule>

# Deny access to application directories if someone tries to browse them directly
<IfModule mod_authz_core.c>
    <FilesMatch "^(?:app|bootstrap|config|database|resources|routes|storage|tests|vendor)(?:/.*)?$">
        Require all denied
    </FilesMatch>
</IfModule>

<IfModule !mod_authz_core.c>
    # Fallback for older Apache versions
    RewriteRule ^(app|bootstrap|config|database|resources|routes|storage|tests|vendor)(/.*)?$ - [F,L,NC]
</IfModule>

# Prevent directory listing
Options -Indexes
